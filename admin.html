<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω t√†i kho·∫£n - OKVIP SHOP</title>
    <!-- ∆Øu ti√™n d√πng local, n·∫øu kh√¥ng c√≥ s·∫Ω d√πng CDN -->
    <link rel="stylesheet" href="tailwind.min.css" onerror="this.onerror=null;this.href='https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css'">
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <!-- N·∫øu kh√¥ng d√πng CDN, h√£y comment ho·∫∑c x√≥a tailwind.config -->
    <!-- <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        purple: { 600: '#9333ea' }, pink: { 600: '#db2777' }, green: { 400: '#4ade80' }, red: { 500: '#ef4444' }
                    }
                }
            }
        }
    </script> -->
    <style>
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        @media (max-width: 640px) {
            /* Mobile menu styles */
            .mobile-menu-hidden { display: none !important; }
            .mobile-user-menu { position: relative; }
            .mobile-user-menu .user-menu-dropdown { 
                position: absolute; 
                top: 100%; 
                right: 0; 
                background: rgba(0, 0, 0, 0.9); 
                backdrop-filter: blur(10px); 
                border: 1px solid rgba(255, 255, 255, 0.2); 
                border-radius: 1rem; 
                padding: 0.5rem; 
                min-width: 200px; 
                z-index: 1000; 
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3); 
            }
            .mobile-user-menu .user-menu-dropdown button { 
                width: 100%; 
                text-align: left; 
                padding: 0.75rem 1rem; 
                border-radius: 0.5rem; 
                margin-bottom: 0.25rem; 
                font-size: 0.9rem; 
                transition: all 0.2s; 
            }
            .mobile-user-menu .user-menu-dropdown button:hover { 
                background: rgba(255, 255, 255, 0.1); 
            }
            .mobile-user-menu .user-menu-dropdown .user-info { 
                padding: 0.75rem 1rem; 
                border-bottom: 1px solid rgba(255, 255, 255, 0.2); 
                margin-bottom: 0.5rem; 
            }
            .mobile-user-menu .user-menu-dropdown .user-info .balance { 
                font-size: 1.1rem; 
                font-weight: bold; 
                color: #4ade80; 
            }
            
            /* Mobile responsive adjustments */
            nav .flex.justify-between { flex-direction: column; gap: 1rem; }
            nav h1 { font-size: 1.1rem; text-align: center; }
            .glass-effect, .max-w-7xl, .max-w-5xl { padding-left: 0.5rem !important; padding-right: 0.5rem !important; }
            .overflow-x-auto { overflow-x: auto !important; }
            table { font-size: 0.8rem !important; }
            th, td { padding: 0.5rem !important; }
            .grid.grid-cols-1.md\:grid-cols-4 { grid-template-columns: 1fr; gap: 0.5rem; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-pink-900 to-purple-800 min-h-screen text-white">
    <nav class="glass-effect border-b border-white/20">
        <div class="max-w-5xl mx-auto px-4 flex justify-between items-center h-16">
            <div class="flex items-center space-x-4">
                <img src="logoshop.png" alt="OKVIP SHOP" class="h-10 w-auto">
                <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Qu·∫£n l√Ω t√†i kho·∫£n</h1>
            </div>
            <div class="flex items-center space-x-4">
                <!-- Desktop navigation -->
                <a href="index.html" class="hidden sm:block px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg hover:from-purple-700 hover:to-pink-700 font-medium">V·ªÅ trang ch√≠nh</a>
                
                <!-- Mobile User Menu -->
                <div id="mobileUserMenu" class="sm:hidden mobile-user-menu">
                    <button id="mobileUserToggle" class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold text-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-300">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </button>
                    <div id="mobileUserDropdown" class="user-menu-dropdown hidden">
                        <div class="user-info">
                            <div class="text-sm text-gray-300">Admin Panel</div>
                            <div class="text-white font-bold">Qu·∫£n l√Ω h·ªá th·ªëng</div>
                        </div>
                        <a href="index.html" class="block w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all duration-300 font-medium text-center py-3">
                            üè† V·ªÅ trang ch√≠nh
                        </a>
                        <button id="mobileLogoutBtn" class="w-full bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg hover:from-red-600 hover:to-pink-600 transition-all duration-300 font-medium">
                            üö™ ƒêƒÉng xu·∫•t
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Form ƒëƒÉng nh·∫≠p admin n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p ho·∫∑c kh√¥ng ph·∫£i admin -->
    <div id="adminLoginSection" class="flex flex-col items-center justify-center min-h-[60vh] py-8 hidden">
        <div class="bg-white/10 rounded-2xl p-8 shadow-xl max-w-sm w-full">
            <h2 class="text-xl font-bold mb-6 text-center">ƒêƒÉng nh·∫≠p Admin</h2>
            <form id="adminLoginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">T√™n ƒëƒÉng nh·∫≠p</label>
                    <input type="text" id="adminUsername" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">M·∫≠t kh·∫©u</label>
                    <input type="password" id="adminPassword" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                </div>
                <button type="submit" class="w-full px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold">ƒêƒÉng nh·∫≠p</button>
            </form>
            <div id="adminLoginError" class="text-red-400 text-center mt-4 hidden"></div>
        </div>
    </div>

    <!-- Qu·∫£n l√Ω user -->
    <div id="adminPanel" class="max-w-7xl mx-auto px-4 py-8 hidden">
        <!-- Tab Navigation -->
        <div class="flex space-x-4 mb-6">
            <button id="usersTab" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg font-medium active-tab">
                Qu·∫£n l√Ω User
            </button>
            <button id="ordersTab" class="px-6 py-3 bg-white/10 rounded-lg font-medium hover:bg-white/20 transition-colors">
                ƒê∆°n h√†ng ch·ªù duy·ªát
            </button>
            <button id="accountsTab" class="px-6 py-3 bg-white/10 rounded-lg font-medium hover:bg-white/20 transition-colors">
                Qu·∫£n l√Ω T√†i kho·∫£n Shop
            </button>
        </div>

        <!-- Users Tab -->
        <div id="usersSection" class="bg-white/10 rounded-2xl p-6 shadow-xl">
            <h2 class="text-xl font-bold mb-6">Danh s√°ch t√†i kho·∫£n ng∆∞·ªùi d√πng</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-left">
                    <thead>
                        <tr class="bg-purple-800/40">
                            <th class="px-4 py-2">T√™n ƒëƒÉng nh·∫≠p</th>
                            <th class="px-4 py-2">Email</th>
                            <th class="px-4 py-2">S·ªë d∆∞</th>
                            <th class="px-4 py-2">Quy·ªÅn</th>
                            <th class="px-4 py-2">H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody" class="bg-white/5">
                        <!-- User rows s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="ordersSection" class="bg-white/10 rounded-2xl p-6 shadow-xl hidden">
            <h2 class="text-xl font-bold mb-6">ƒê∆°n h√†ng ch·ªù duy·ªát</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-left">
                    <thead>
                        <tr class="bg-purple-800/40">
                            <th class="px-4 py-2">Th·ªùi gian</th>
                            <th class="px-4 py-2">Ng∆∞·ªùi mua</th>
                            <th class="px-4 py-2">User ACC</th>
                            <th class="px-4 py-2">Game ch·ªçn</th>
                            <th class="px-4 py-2">T√™n game</th>
                            <th class="px-4 py-2">SƒêT (4 s·ªë cu·ªëi)</th>
                            <th class="px-4 py-2">T√†i kho·∫£n</th>
                            <th class="px-4 py-2">Gi√°</th>
                            <th class="px-4 py-2">Tr·∫°ng th√°i</th>
                            <th class="px-4 py-2">H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody" class="bg-white/5">
                        <!-- Order rows s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Accounts Tab -->
        <div id="accountsSection" class="bg-white/10 rounded-2xl p-6 shadow-xl hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">Qu·∫£n l√Ω T√†i kho·∫£n Shop</h2>
                <div class="flex space-x-2">
                    <button id="refreshAccountsBtn" class="px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all duration-300 font-medium text-white">
                        L√†m m·ªõi
                    </button>
                    <button id="uploadAccountsBtn" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 font-medium text-white">
                        Upload T√†i kho·∫£n
                    </button>
                    <button id="deleteSelectedAccountsBtn" class="px-4 py-2 bg-gradient-to-r from-red-600 to-pink-600 rounded-lg hover:from-red-700 hover:to-pink-700 transition-all duration-300 font-medium text-white">
                        X√≥a t·∫•t c·∫£ ƒë√£ ch·ªçn
                    </button>
                </div>
            </div>
            
            <!-- Filters -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Website</label>
                    <select id="accountWebsiteFilter" class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:ring-2 focus:ring-purple-500">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="OK9">OK9</option>
                        <option value="78win">78win</option>
                        <option value="F168">F168</option>
                        <option value="MB66">MB66</option>
                        <option value="QQ88">QQ88</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Kho·∫£ng ƒëi·ªÉm</label>
                    <select id="accountPointsFilter" class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:ring-2 focus:ring-purple-500">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="0-50">0 - 50 ƒëi·ªÉm</option>
                        <option value="51-100">51 - 100 ƒëi·ªÉm</option>
                        <option value="101-200">101 - 200 ƒëi·ªÉm</option>
                        <option value="200+">200+ ƒëi·ªÉm</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">T√¨m ki·∫øm</label>
                    <input type="text" id="accountSearchInput" placeholder="T√¨m ki·∫øm..." class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-purple-500">
                </div>
                <div class="flex items-end">
                    <button id="filterAccountsBtn" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-2 px-4 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all duration-300 font-medium">
                        L·ªçc
                    </button>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-left">
                    <thead>
                        <tr class="bg-purple-800/40">
                            <th class="px-2 py-2"><input type="checkbox" id="selectAllAccounts"></th>
                            <th class="px-4 py-2">User ACC</th>
                            <th class="px-4 py-2">ƒêi·ªÉm</th>
                            <th class="px-4 py-2">Tr·∫°ng th√°i</th>
                            <th class="px-4 py-2">Gi√° b√°n</th>
                            <th class="px-4 py-2">Websites</th>
                            <th class="px-4 py-2">Ghi ch√∫</th>
                            <th class="px-4 py-2">H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="accountsTableBody" class="bg-white/5">
                        <!-- Account rows s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal ch·ªânh s·ª≠a -->
    <div id="editModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-8 relative">
                <h3 class="text-xl font-bold mb-4">Ch·ªânh s·ª≠a t√†i kho·∫£n</h3>
                <form id="editUserForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">T√™n ƒëƒÉng nh·∫≠p</label>
                        <input type="text" id="editUsername" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Email</label>
                        <input type="email" id="editEmail" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">S·ªë d∆∞</label>
                        <input type="number" id="editBalance" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" min="0" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Quy·ªÅn</label>
                        <select id="editRole" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            <option value="user">User</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-2 pt-2">
                        <button type="button" id="closeEditModal" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200">H·ªßy</button>
                        <button type="submit" class="px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold">L∆∞u</button>
                    </div>
                </form>
                <button id="closeEditModalX" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal upload t√†i kho·∫£n -->
    <div id="uploadAccountsModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full p-8 relative">
                <h3 class="text-xl font-bold mb-4">Upload T√†i kho·∫£n</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Ch·ªçn file ACC.txt</label>
                        <input type="file" id="accountsFile" accept=".txt" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Ho·∫∑c paste n·ªôi dung tr·ª±c ti·∫øp</label>
                        <textarea id="accountsContent" rows="10" placeholder="Paste n·ªôi dung t√†i kho·∫£n theo format: privateKey|proxy|username|password|status|points|message|websites|note" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></textarea>
                    </div>
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-yellow-600 dark:text-yellow-400 mt-0.5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                            <div class="text-sm text-yellow-700 dark:text-yellow-300">
                                <strong>L∆∞u √Ω:</strong> Format t√†i kho·∫£n ph·∫£i ƒë√∫ng: privateKey|proxy|username|password|status|points|message|websites|note
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2 pt-2">
                        <button type="button" id="closeUploadModal" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200">H·ªßy</button>
                        <button type="button" id="uploadAccountsSubmit" class="px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold">Upload</button>
                    </div>
                </div>
                <button id="closeUploadModalX" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal kh√¥ng duy·ªát ƒë∆°n h√†ng -->
    <div id="rejectOrderModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-8 relative">
                <h3 class="text-xl font-bold mb-4 text-red-600">Kh√¥ng duy·ªát ƒë∆°n h√†ng</h3>
                <div class="space-y-4">
                    <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-red-600 dark:text-red-400 mt-0.5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                            <div class="text-sm text-red-700 dark:text-red-300">
                                <strong>L∆∞u √Ω:</strong> Khi kh√¥ng duy·ªát, t√†i kho·∫£n s·∫Ω ƒë∆∞·ª£c kh√¥i ph·ª•c v·ªÅ shop v√† ti·ªÅn s·∫Ω ƒë∆∞·ª£c ho√†n l·∫°i cho kh√°ch h√†ng.
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">L√Ω do kh√¥ng duy·ªát (b·∫Øt bu·ªôc)</label>
                        <textarea id="rejectReason" rows="4" placeholder="Nh·∫≠p l√Ω do kh√¥ng duy·ªát ƒë∆°n h√†ng n√†y..." required class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></textarea>
                    </div>
                    <div class="flex justify-end space-x-2 pt-2">
                        <button type="button" id="closeRejectModal" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200">H·ªßy</button>
                        <button type="button" id="confirmRejectBtn" class="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white font-bold">X√°c nh·∫≠n kh√¥ng duy·ªát</button>
                    </div>
                </div>
                <button id="closeRejectModalX" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal x·ª≠ l√Ω ƒë∆°n h√†ng -->
    <div id="orderModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-8 relative">
                <h3 class="text-xl font-bold mb-4">X·ª≠ l√Ω ƒë∆°n h√†ng</h3>
                <div id="orderDetails" class="space-y-4 mb-6">
                    <!-- Order details will be populated here -->
                </div>
                <form id="orderActionForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Tr·∫°ng th√°i</label>
                        <select id="orderStatus" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            <option value="pending">Ch·ªù duy·ªát</option>
                            <option value="approved">ƒê√£ duy·ªát</option>
                            <option value="rejected">T·ª´ ch·ªëi</option>
                            <option value="completed">Ho√†n th√†nh</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Ghi ch√∫ (t√πy ch·ªçn)</label>
                        <textarea id="adminNote" rows="3" placeholder="Nh·∫≠p ghi ch√∫ cho kh√°ch h√†ng..." class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></textarea>
                    </div>
                    <div class="flex justify-end space-x-2 pt-2">
                        <button type="button" id="closeOrderModal" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200">H·ªßy</button>
                        <button type="button" id="rejectOrderBtn" class="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white font-bold">Kh√¥ng duy·ªát</button>
                        <button type="submit" class="px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold">C·∫≠p nh·∫≠t</button>
                    </div>
                </form>
                <button id="closeOrderModalX" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal s·ª≠a t√†i kho·∫£n -->
    <div id="editAccountModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-8 relative">
                <h3 class="text-xl font-bold mb-4">S·ª≠a t√†i kho·∫£n</h3>
                <form id="editAccountForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Username</label>
                        <input type="text" id="editAccUsername" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Password</label>
                        <input type="text" id="editAccPassword" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Points</label>
                        <input type="number" id="editAccPoints" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Websites</label>
                        <input type="text" id="editAccWebsites" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Note</label>
                        <input type="text" id="editAccNote" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    </div>
                    <div class="flex justify-end space-x-2 pt-2">
                        <button type="button" id="closeEditAccountModal" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200">H·ªßy</button>
                        <button type="submit" class="px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold">L∆∞u</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
    // H√†m fetchWithAuth: t·ª± ƒë·ªông th√™m Authorization header v·ªõi token
    function fetchWithAuth(url, options = {}) {
        const token = localStorage.getItem('token');
        options.headers = options.headers || {};
        if (token) {
            options.headers['Authorization'] = 'Bearer ' + token;
        }
        return fetch(url, options).then(res => {
            if (res.status === 401 || res.status === 403) {
                // N·∫øu h·∫øt h·∫°n token ho·∫∑c kh√¥ng x√°c th·ª±c, chuy·ªÉn v·ªÅ form ƒëƒÉng nh·∫≠p admin
                localStorage.removeItem('currentUser');
                localStorage.removeItem('token');
                window.location.reload();
                throw new Error('Authentication required');
            }
            return res;
        });
    }
    // Ki·ªÉm tra quy·ªÅn admin, n·∫øu ch∆∞a ƒë√∫ng th√¨ hi·ªÉn th·ªã form ƒëƒÉng nh·∫≠p admin
    let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
    function isAdminUser(user) {
        return user && user.role === 'admin';
    }
    function showAdminPanel() {
        document.getElementById('adminLoginSection').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
        fetchUsers();
        fetchOrders();
        fetchAccounts();
    }
    function showAdminLogin() {
        document.getElementById('adminPanel').classList.add('hidden');
        document.getElementById('adminLoginSection').classList.remove('hidden');
    }
    if (!isAdminUser(currentUser)) {
        showAdminLogin();
    } else {
        showAdminPanel();
    }

    // X·ª≠ l√Ω ƒëƒÉng nh·∫≠p admin
    document.getElementById('adminLoginForm').onsubmit = function(e) {
        e.preventDefault();
        const username = document.getElementById('adminUsername').value;
        const password = document.getElementById('adminPassword').value;
        fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success && isAdminUser(data.user)) {
                localStorage.setItem('currentUser', JSON.stringify(data.user));
                if (data.token) localStorage.setItem('token', data.token);
                currentUser = data.user;
                showAdminPanel();
            } else {
                document.getElementById('adminLoginError').textContent = 'Sai t√†i kho·∫£n ho·∫∑c kh√¥ng c√≥ quy·ªÅn admin!';
                document.getElementById('adminLoginError').classList.remove('hidden');
            }
        });
    };

    // Tab management
    document.getElementById('usersTab').onclick = function() {
        document.getElementById('usersSection').classList.remove('hidden');
        document.getElementById('ordersSection').classList.add('hidden');
        document.getElementById('usersTab').classList.add('bg-gradient-to-r', 'from-purple-600', 'to-pink-600');
        document.getElementById('usersTab').classList.remove('bg-white/10');
        document.getElementById('ordersTab').classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-pink-600');
        document.getElementById('ordersTab').classList.add('bg-white/10');
    };
    
    document.getElementById('ordersTab').onclick = function() {
        document.getElementById('ordersSection').classList.remove('hidden');
        document.getElementById('usersSection').classList.add('hidden');
        document.getElementById('accountsSection').classList.add('hidden');
        document.getElementById('ordersTab').classList.add('bg-gradient-to-r', 'from-purple-600', 'to-pink-600');
        document.getElementById('ordersTab').classList.remove('bg-white/10');
        document.getElementById('usersTab').classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-pink-600');
        document.getElementById('usersTab').classList.add('bg-white/10');
        document.getElementById('accountsTab').classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-pink-600');
        document.getElementById('accountsTab').classList.add('bg-white/10');
        fetchOrders();
    };
    
    document.getElementById('accountsTab').onclick = function() {
        document.getElementById('accountsSection').classList.remove('hidden');
        document.getElementById('usersSection').classList.add('hidden');
        document.getElementById('ordersSection').classList.add('hidden');
        document.getElementById('accountsTab').classList.add('bg-gradient-to-r', 'from-purple-600', 'to-pink-600');
        document.getElementById('accountsTab').classList.remove('bg-white/10');
        document.getElementById('usersTab').classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-pink-600');
        document.getElementById('usersTab').classList.add('bg-white/10');
        document.getElementById('ordersTab').classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-pink-600');
        document.getElementById('ordersTab').classList.add('bg-white/10');
        fetchAccounts();
    };

    // Qu·∫£n l√Ω user nh∆∞ c≈©
    let users = [];
    function fetchUsers() {
        fetchWithAuth(`/api/admin/users?username=${encodeURIComponent(currentUser.username)}`)
            .then(res => res.json())
            .then(data => {
                users = data;
                renderUsers();
            });
    }

    // Qu·∫£n l√Ω t√†i kho·∫£n shop
    let accounts = [];
    function fetchAccounts() {
        if (isAdminUser(currentUser)) {
            // N·∫øu l√† admin, g·ªçi API admin ƒë·ªÉ l·∫•y ƒë·∫ßy ƒë·ªß th√¥ng tin
            fetchWithAuth(`/api/admin/accounts?username=${encodeURIComponent(currentUser.username)}`)
                .then(res => res.json())
                .then(async data => {
                    // N·∫øu data.data l√† chu·ªói m√£ h√≥a, c·∫ßn gi·∫£i m√£
                    if (typeof data.data === 'string' && data.data.length > 100) {
                        const decryptRes = await fetchWithAuth('/api/decrypt', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ encryptedData: data.data })
                        });
                        const decryptData = await decryptRes.json();
                        if (decryptData.success && decryptData.decryptedData) {
                            accounts = parseAccounts(decryptData.decryptedData);
                        } else {
                            accounts = [];
                        }
                    } else {
                        accounts = parseAccounts(data.data);
                    }
                    renderAccounts();
                })
                .catch(error => {
                    console.error('Error fetching accounts:', error);
                    // Fallback to public API if admin API fails
                    fetchWithAuth('/api/accounts')
                        .then(res => res.json())
                        .then(data => {
                            accounts = data.accounts || [];
                            renderAccounts();
                        });
                });
        } else {
            // N·∫øu kh√¥ng ph·∫£i admin, g·ªçi API public ƒë·ªÉ l·∫•y id, points, username (ƒë√£ mask), websites
            fetchWithAuth('/api/accounts')
                .then(res => res.json())
                .then(data => {
                    accounts = data.accounts || [];
                    renderAccounts();
                })
                .catch(error => {
                    console.error('Error fetching accounts:', error);
                    accounts = []; // Clear accounts if public API fails
                    renderAccounts();
                });
        }
    }

    function parseAccounts(data) {
        return data.trim().split('\n').map(line => {
            const parts = line.split('|');
            if (parts.length >= 8) {
                return {
                    privateKey: parts[0],
                    proxy: parts[1],
                    username: parts[2],
                    password: parts[3],
                    status: parts[4],
                    points: parseInt(parts[5]) || 0,
                    message: parts[6],
                    websites: parts[7],
                    note: parts[8] || '',
                    accountLine: line,
                    id: generateAccountId(line)
                };
            }
            return null;
        }).filter(account => account !== null);
    }

    function generateAccountId(accountLine) {
        // Simple hash function for account ID
        let hash = 0;
        for (let i = 0; i < accountLine.length; i++) {
            const char = accountLine.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convert to 32bit integer
        }
        return Math.abs(hash).toString(16).substring(0, 8);
    }

    function renderAccounts() {
        const tbody = document.getElementById('accountsTableBody');
        const filteredAccounts = getFilteredAccounts();
        
        if (filteredAccounts.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" class="px-4 py-8 text-center text-gray-400">Kh√¥ng c√≥ t√†i kho·∫£n n√†o</td></tr>';
            return;
        }
        
        tbody.innerHTML = filteredAccounts.map((account, idx) => {
            const price = Math.ceil(parseInt(account.points) / 2) * 1000 + 5000;
            
            return `
                <tr class="border-b border-white/10">
                    <td class="px-2 py-2 text-center"><input type="checkbox" class="accountCheckbox" data-idx="${idx}"></td>
                    <td class="px-4 py-2 font-mono">${maskUsername(account.username)}</td>
                    <td class="px-4 py-2 font-bold text-purple-400">${account.points}</td>
                    <td class="px-4 py-2">
                        <span class="px-2 py-1 rounded text-xs text-white ${account.status === 'active' ? 'bg-green-500' : 'bg-red-500'}">${account.status}</span>
                    </td>
                    <td class="px-4 py-2 text-green-400 font-bold">${formatCurrency(price)}</td>
                    <td class="px-4 py-2">
                        <div class="flex flex-wrap gap-1">
                            ${account.websites.split(' ').map(site => 
                                `<span class="px-2 py-1 bg-purple-600/20 text-purple-300 rounded text-xs">${site}</span>`
                            ).join('')}
                        </div>
                    </td>
                    <td class="px-4 py-2 text-sm text-gray-400">${account.note || '-'}</td>
                    <td class="px-4 py-2 space-x-2">
                        <button class="editAccountBtn px-3 py-1 bg-blue-600 rounded text-white text-xs" data-idx="${idx}">S·ª≠a</button>
                        <button class="deleteAccountBtn px-3 py-1 bg-red-500 rounded text-white text-xs" data-idx="${idx}">X√≥a</button>
                    </td>
                </tr>
            `;
        }).join('');
        
        document.querySelectorAll('.editAccountBtn').forEach(btn => btn.onclick = () => editAccount(btn.dataset.idx));
        document.querySelectorAll('.deleteAccountBtn').forEach(btn => btn.onclick = () => deleteAccount(btn.dataset.idx));
        document.getElementById('selectAllAccounts').onclick = function() {
            const checked = this.checked;
            document.querySelectorAll('.accountCheckbox').forEach(cb => cb.checked = checked);
        };
    }

    function getFilteredAccounts() {
        let filtered = [...accounts];

        // Website filter
        const websiteFilter = document.getElementById('accountWebsiteFilter').value;
        if (websiteFilter) {
            filtered = filtered.filter(acc => acc.websites.includes(websiteFilter));
        }

        // Points filter
        const pointsFilter = document.getElementById('accountPointsFilter').value;
        if (pointsFilter) {
            const [min, max] = pointsFilter.split('-').map(Number);
            if (max) {
                filtered = filtered.filter(acc => parseInt(acc.points) >= min && parseInt(acc.points) <= max);
            } else {
                filtered = filtered.filter(acc => parseInt(acc.points) >= min);
            }
        }

        // Search filter
        const searchTerm = document.getElementById('accountSearchInput').value.toLowerCase();
        if (searchTerm) {
            filtered = filtered.filter(acc => 
                acc.privateKey.toLowerCase().includes(searchTerm) ||
                acc.proxy.toLowerCase().includes(searchTerm) ||
                acc.websites.toLowerCase().includes(searchTerm) ||
                acc.note.toLowerCase().includes(searchTerm) ||
                acc.points.toString().includes(searchTerm)
            );
        }

        return filtered;
    }
    function renderUsers() {
        const tbody = document.getElementById('userTableBody');
        tbody.innerHTML = users.map((u, idx) => `
            <tr class="border-b border-white/10">
                <td class="px-4 py-2 font-bold">${u.username}</td>
                <td class="px-4 py-2">${u.email}</td>
                <td class="px-4 py-2 text-green-400 font-bold">${formatCurrency(u.balance)}</td>
                <td class="px-4 py-2">${u.role}</td>
                <td class="px-4 py-2 space-x-2">
                    <button class="editBtn px-3 py-1 bg-purple-600 rounded text-white" data-idx="${idx}">S·ª≠a</button>
                    <button class="deleteBtn px-3 py-1 bg-red-500 rounded text-white" data-idx="${idx}">X√≥a</button>
                </td>
            </tr>
        `).join('');
        document.querySelectorAll('.editBtn').forEach(btn => btn.onclick = () => openEditModal(btn.dataset.idx));
        document.querySelectorAll('.deleteBtn').forEach(btn => btn.onclick = () => deleteUser(btn.dataset.idx));
    }
    function formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
    }
    // S·ª≠a user
    let editingIdx = null;
    function openEditModal(idx) {
        editingIdx = idx;
        const u = users[idx];
        document.getElementById('editUsername').value = u.username;
        document.getElementById('editEmail').value = u.email;
        document.getElementById('editBalance').value = u.balance;
        document.getElementById('editRole').value = u.role;
        document.getElementById('editModal').classList.remove('hidden');
    }
    document.getElementById('closeEditModal').onclick = document.getElementById('closeEditModalX').onclick = function() {
        document.getElementById('editModal').classList.add('hidden');
    };
    document.getElementById('editUserForm').onsubmit = function(e) {
        e.preventDefault();
        const username = document.getElementById('editUsername').value;
        const email = document.getElementById('editEmail').value;
        const balance = parseInt(document.getElementById('editBalance').value) || 0;
        const role = document.getElementById('editRole').value;
        fetchWithAuth(`/api/users/${encodeURIComponent(username)}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, balance, role })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                fetchUsers();
                document.getElementById('editModal').classList.add('hidden');
            } else {
                alert(data.error || 'L·ªói khi c·∫≠p nh·∫≠t user!');
            }
        });
    };
    // X√≥a user
    function deleteUser(idx) {
        const username = users[idx].username;
        if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t√†i kho·∫£n n√†y?')) {
            fetchWithAuth(`/api/users/${encodeURIComponent(username)}`, { method: 'DELETE' })
                .then(res => res.json())
                .then(data => {
                    if (data.success) fetchUsers();
                    else alert(data.error || 'L·ªói khi x√≥a user!');
                });
        }
    }

    // Qu·∫£n l√Ω ƒë∆°n h√†ng
    let orders = [];
    function fetchOrders() {
        fetchWithAuth(`/api/admin/orders?username=${encodeURIComponent(currentUser.username)}`)
            .then(res => res.json())
            .then(async data => {
                // N·∫øu tr·∫£ v·ªÅ chu·ªói m√£ h√≥a, c·∫ßn gi·∫£i m√£
                if (typeof data === 'string' && data.length > 100) {
                    const decryptRes = await fetchWithAuth('/api/decrypt', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ encryptedData: data })
                    });
                    const decryptData = await decryptRes.json();
                    if (decryptData.success && decryptData.decryptedData) {
                        orders = JSON.parse(decryptData.decryptedData);
                    } else {
                        orders = [];
                    }
                } else {
                    orders = data;
                }
                renderOrders();
            })
            .catch(error => {
                console.error('Error fetching orders:', error);
                // Fallback to public API if admin API fails
                fetchWithAuth('/api/orders')
                    .then(res => res.json())
                    .then(data => {
                        orders = data;
                        renderOrders();
                    });
            });
    }

    function renderOrders() {
        const tbody = document.getElementById('ordersTableBody');
        if (orders.length === 0) {
            tbody.innerHTML = '<tr><td colspan="9" class="px-4 py-8 text-center text-gray-400">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</td></tr>';
            return;
        }
        
        tbody.innerHTML = orders.map((order, idx) => {
            const statusColors = {
                'pending': 'bg-yellow-500',
                'approved': 'bg-blue-500',
                'rejected': 'bg-red-500',
                'completed': 'bg-green-500'
            };
            const statusText = {
                'pending': 'Ch·ªù duy·ªát',
                'approved': 'ƒê√£ duy·ªát',
                'rejected': 'T·ª´ ch·ªëi',
                'completed': 'Ho√†n th√†nh'
            };
            const createdAt = new Date(order.createdAt).toLocaleString('vi-VN');
            return `
                <tr class="border-b border-white/10">
                    <td class="px-4 py-2 text-sm">${createdAt}</td>
                    <td class="px-4 py-2 font-bold">${order.userId}</td>
                    <td class="px-4 py-2 font-mono">${maskUsername(order.username || order.userId)}</td>
                    <td class="px-4 py-2 font-bold text-blue-400">${order.selectedGame}</td>
                    <td class="px-4 py-2">${order.gameUsername}</td>
                    <td class="px-4 py-2">${order.phoneLast4}</td>
                    <td class="px-4 py-2">${order.accountPoints} ƒëi·ªÉm (${order.accountWebsites})</td>
                    <td class="px-4 py-2 text-green-400 font-bold">${formatCurrency(order.accountPrice)}</td>
                    <td class="px-4 py-2">
                        <span class="px-2 py-1 rounded text-xs text-white ${statusColors[order.status]}">${statusText[order.status]}</span>
                        ${order.adminNote ? `<div class="text-xs text-gray-400 mt-1">${order.adminNote}</div>` : ''}
                    </td>
                    <td class="px-4 py-2 space-x-2">
                        <button class="processOrderBtn px-3 py-1 bg-purple-600 rounded text-white text-xs" data-idx="${idx}">X·ª≠ l√Ω</button>
                        <button class="deleteOrderBtn px-3 py-1 bg-red-500 rounded text-white text-xs" data-idx="${idx}">X√≥a</button>
                        ${order.status === 'pending' ? `<button class="quickRejectBtn px-3 py-1 bg-yellow-600 rounded text-white text-xs" data-idx="${idx}">T·ª´ ch·ªëi nhanh</button>` : ''}
                    </td>
                </tr>
            `;
        }).join('');
        document.querySelectorAll('.processOrderBtn').forEach(btn => btn.onclick = () => openOrderModal(btn.dataset.idx));
        document.querySelectorAll('.deleteOrderBtn').forEach(btn => btn.onclick = () => deleteOrder(btn.dataset.idx));
        document.querySelectorAll('.quickRejectBtn').forEach(btn => btn.onclick = () => quickRejectOrder(btn.dataset.idx));
    }

    // Th√™m h√†m t·ª´ ch·ªëi nhanh
    function quickRejectOrder(idx) {
        const order = orders[idx];
        if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën t·ª´ ch·ªëi ƒë∆°n h√†ng n√†y v·ªõi l√Ω do: ƒê∆°n l·ªói hay t·∫°o ƒë∆°n kh√°c?')) return;
        // Kh√¥i ph·ª•c t√†i kho·∫£n v·ªÅ shop
        fetchWithAuth('/api/accounts/restore', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ accountId: order.accountId })
        })
        .then(res => res.json())
        .then(data => {
            // Ch·∫•p nh·∫≠n c·∫£ tr∆∞·ªùng h·ª£p ƒë√£ kh√¥i ph·ª•c r·ªìi (alreadyRestored)
            if (data.success || data.alreadyRestored) {
                // C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng th√†nh "rejected"
                return fetchWithAuth(`/api/orders/${order.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        status: 'rejected', 
                        adminNote: 'L√Ω do kh√¥ng duy·ªát: ƒê∆°n l·ªói hay t·∫°o ƒë∆°n kh√°c' 
                    })
                });
            } else {
                throw new Error('L·ªói khi kh√¥i ph·ª•c t√†i kho·∫£n');
            }
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert('ƒê√£ t·ª´ ch·ªëi ƒë∆°n h√†ng th√†nh c√¥ng!');
                fetchOrders();
            } else {
                throw new Error('L·ªói khi c·∫≠p nh·∫≠t ƒë∆°n h√†ng');
            }
        })
        .catch(error => {
            alert(error.message || 'L·ªói khi x·ª≠ l√Ω t·ª´ ch·ªëi nhanh!');
        });
    }

    // X·ª≠ l√Ω ƒë∆°n h√†ng
    let editingOrderIdx = null;
    function openOrderModal(idx) {
        editingOrderIdx = idx;
        const order = orders[idx];
        
        document.getElementById('orderDetails').innerHTML = `
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-2">
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Ng∆∞·ªùi mua:</span>
                    <span class="font-bold">${order.userId}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Email:</span>
                    <span>${order.userEmail}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Game ch·ªçn:</span>
                    <span class="font-bold">${order.selectedGame}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">T√™n game:</span>
                    <span class="font-bold">${order.gameUsername}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">SƒêT (4 s·ªë cu·ªëi):</span>
                    <span>${order.phoneLast4}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">T√†i kho·∫£n:</span>
                    <span class="font-bold">${order.accountPoints} ƒëi·ªÉm</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Websites:</span>
                    <span>${order.accountWebsites}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Gi√°:</span>
                    <span class="font-bold text-green-600">${formatCurrency(order.accountPrice)}</span>
                </div>
            </div>
        `;
        
        document.getElementById('orderStatus').value = order.status;
        document.getElementById('adminNote').value = order.adminNote || '';
        document.getElementById('orderModal').classList.remove('hidden');
    }

    // Close order modal
    document.getElementById('closeOrderModal').onclick = document.getElementById('closeOrderModalX').onclick = function() {
        document.getElementById('orderModal').classList.add('hidden');
    };

    // Close reject modal
    document.getElementById('closeRejectModal').onclick = document.getElementById('closeRejectModalX').onclick = function() {
        document.getElementById('rejectOrderModal').classList.add('hidden');
        document.getElementById('rejectReason').value = '';
    };

    // Reject order button
    document.getElementById('rejectOrderBtn').onclick = function() {
        document.getElementById('rejectOrderModal').classList.remove('hidden');
    };

    // Confirm reject order
    document.getElementById('confirmRejectBtn').onclick = function() {
        const rejectReason = document.getElementById('rejectReason').value.trim();
        if (!rejectReason) {
            alert('Vui l√≤ng nh·∫≠p l√Ω do kh√¥ng duy·ªát!');
            return;
        }
        
        const order = orders[editingOrderIdx];
        
        // Kh√¥i ph·ª•c t√†i kho·∫£n v·ªÅ shop
        fetchWithAuth('/api/accounts/restore', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ accountId: order.accountId })
        })
        .then(res => res.json())
        .then(data => {
            // Ch·∫•p nh·∫≠n c·∫£ tr∆∞·ªùng h·ª£p ƒë√£ kh√¥i ph·ª•c r·ªìi (alreadyRestored)
            if (data.success || data.alreadyRestored) {
                // C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng th√†nh "rejected"
                return fetchWithAuth(`/api/orders/${order.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        status: 'rejected', 
                        adminNote: `L√Ω do kh√¥ng duy·ªát: ${rejectReason}` 
                    })
                });
            } else {
                throw new Error('L·ªói khi kh√¥i ph·ª•c t√†i kho·∫£n');
            }
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert('ƒê√£ kh√¥ng duy·ªát ƒë∆°n h√†ng th√†nh c√¥ng! T√†i kho·∫£n ƒë√£ ƒë∆∞·ª£c kh√¥i ph·ª•c v·ªÅ shop v√† ti·ªÅn ƒë√£ ƒë∆∞·ª£c ho√†n l·∫°i cho kh√°ch h√†ng.');
                document.getElementById('rejectOrderModal').classList.add('hidden');
                document.getElementById('orderModal').classList.add('hidden');
                document.getElementById('rejectReason').value = '';
                fetchOrders();
            } else {
                throw new Error('L·ªói khi c·∫≠p nh·∫≠t ƒë∆°n h√†ng');
            }
        })
        .catch(error => {
            alert(error.message || 'L·ªói khi x·ª≠ l√Ω kh√¥ng duy·ªát ƒë∆°n h√†ng!');
        });
    };

    // Update order
    document.getElementById('orderActionForm').onsubmit = function(e) {
        e.preventDefault();
        const order = orders[editingOrderIdx];
        const status = document.getElementById('orderStatus').value;
        const adminNote = document.getElementById('adminNote').value;
        
        // Kh√¥ng cho ph√©p t·ª´ ch·ªëi qua form th√¥ng th∆∞·ªùng
        if (status === 'rejected') {
            alert('Vui l√≤ng s·ª≠ d·ª•ng n√∫t "Kh√¥ng duy·ªát" ƒë·ªÉ t·ª´ ch·ªëi ƒë∆°n h√†ng!');
            return;
        }
        
        // C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng b√¨nh th∆∞·ªùng
        fetchWithAuth(`/api/orders/${order.id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ status, adminNote })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                fetchOrders();
                document.getElementById('orderModal').classList.add('hidden');
            } else {
                alert(data.error || 'L·ªói khi c·∫≠p nh·∫≠t ƒë∆°n h√†ng!');
            }
        });
    };

    // Delete order
    function deleteOrder(idx) {
        const order = orders[idx];
        if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë∆°n h√†ng n√†y?')) {
            fetchWithAuth(`/api/orders/${order.id}`, { method: 'DELETE' })
                .then(res => res.json())
                .then(data => {
                    if (data.success) fetchOrders();
                    else alert(data.error || 'L·ªói khi x√≥a ƒë∆°n h√†ng!');
                });
        }
    }

    // Event listeners cho qu·∫£n l√Ω t√†i kho·∫£n
    document.getElementById('refreshAccountsBtn').onclick = fetchAccounts;
    document.getElementById('uploadAccountsBtn').onclick = function() {
        document.getElementById('uploadAccountsModal').classList.remove('hidden');
    };
    document.getElementById('filterAccountsBtn').onclick = renderAccounts;
    document.getElementById('closeUploadModal').onclick = document.getElementById('closeUploadModalX').onclick = function() {
        document.getElementById('uploadAccountsModal').classList.add('hidden');
    };
    document.getElementById('deleteSelectedAccountsBtn').onclick = function() {
        const checkboxes = document.querySelectorAll('.accountCheckbox:checked');
        if (checkboxes.length === 0) {
            alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt t√†i kho·∫£n ƒë·ªÉ x√≥a!');
            return;
        }
        if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ c√°c t√†i kho·∫£n ƒë√£ ch·ªçn?')) return;
        const idxs = Array.from(checkboxes).map(cb => parseInt(cb.dataset.idx));
        // X√≥a l·∫ßn l∆∞·ª£t t·ª´ng t√†i kho·∫£n (·∫©n kh·ªèi shop)
        (async function deleteBatch() {
            for (const idx of idxs) {
                await fetchWithAuth('/api/accounts/hide', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ accountId: accounts[idx].id })
                });
            }
            fetchAccounts();
        })();
    };

    // Upload t√†i kho·∫£n
    document.getElementById('uploadAccountsSubmit').onclick = function() {
        const file = document.getElementById('accountsFile').files[0];
        const content = document.getElementById('accountsContent').value.trim();
        
        if (!file && !content) {
            alert('Vui l√≤ng ch·ªçn file ho·∫∑c nh·∫≠p n·ªôi dung!');
            return;
        }
        
        let accountsData = '';
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                accountsData = e.target.result;
                uploadAccountsToServer(accountsData);
            };
            reader.readAsText(file);
        } else {
            accountsData = content;
            uploadAccountsToServer(accountsData);
        }
    };

    function uploadAccountsToServer(accountsData) {
        fetchWithAuth('/api/upload-accounts', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ accounts: accountsData })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert('Upload t√†i kho·∫£n th√†nh c√¥ng!');
                document.getElementById('uploadAccountsModal').classList.add('hidden');
                document.getElementById('accountsFile').value = '';
                document.getElementById('accountsContent').value = '';
                fetchAccounts();
            } else {
                alert(data.error || 'L·ªói khi upload t√†i kho·∫£n!');
            }
        })
        .catch(error => {
            console.error('Upload error:', error);
            alert('L·ªói k·∫øt n·ªëi server!');
        });
    }

    // X√≥a t√†i kho·∫£n
    function deleteAccount(idx) {
        const account = accounts[idx];
        if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t√†i kho·∫£n n√†y?')) {
            fetchWithAuth('/api/accounts/hide', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ accountId: account.id })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    fetchAccounts();
                } else {
                    alert(data.error || 'L·ªói khi x√≥a t√†i kho·∫£n!');
                }
            })
            .catch(error => {
                console.error('Delete account error:', error);
                alert('L·ªói k·∫øt n·ªëi server!');
            });
        }
    }

    // S·ª≠a t√†i kho·∫£n (placeholder - c√≥ th·ªÉ m·ªü r·ªông sau)
    function editAccount(idx) {
        const account = accounts[idx];
        alert('Ch·ª©c nƒÉng s·ª≠a t√†i kho·∫£n s·∫Ω ƒë∆∞·ª£c ph√°t tri·ªÉn sau!');
        // TODO: Implement edit account functionality
    }

    // Th√™m API ƒë·ªÉ l·∫•y d·ªØ li·ªáu chi ti·∫øt t√†i kho·∫£n (cho admin)
    function getAccountDetails(accountId) {
        return fetchWithAuth(`/api/accounts/${accountId}/details?username=${encodeURIComponent(currentUser.username)}`, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                // Gi·∫£i m√£ d·ªØ li·ªáu
                return fetchWithAuth('/api/decrypt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ encryptedData: data.encryptedData })
                });
            } else {
                throw new Error(data.error || 'Kh√¥ng th·ªÉ l·∫•y th√¥ng tin t√†i kho·∫£n');
            }
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                return data.decryptedData;
            } else {
                throw new Error('Kh√¥ng th·ªÉ gi·∫£i m√£ d·ªØ li·ªáu');
            }
        });
    }

    // Modal s·ª≠a t√†i kho·∫£n
    let editingAccountIdx = null;
    function editAccount(idx) {
        editingAccountIdx = idx;
        const acc = accounts[idx];
        document.getElementById('editAccountModal').classList.remove('hidden');
        document.getElementById('editAccUsername').value = acc.username;
        document.getElementById('editAccPassword').value = acc.password;
        document.getElementById('editAccPoints').value = acc.points;
        document.getElementById('editAccWebsites').value = acc.websites;
        document.getElementById('editAccNote').value = acc.note || '';
    }
    document.getElementById('closeEditAccountModal').onclick = function() {
        document.getElementById('editAccountModal').classList.add('hidden');
    };
    document.getElementById('editAccountForm').onsubmit = function(e) {
        e.preventDefault();
        const idx = editingAccountIdx;
        const acc = accounts[idx];
        // C·∫≠p nh·∫≠t c√°c tr∆∞·ªùng
        acc.username = document.getElementById('editAccUsername').value;
        acc.password = document.getElementById('editAccPassword').value;
        acc.points = document.getElementById('editAccPoints').value;
        acc.websites = document.getElementById('editAccWebsites').value;
        acc.note = document.getElementById('editAccNote').value;
        // Ghi l·∫°i ACC.txt
        const accFileContent = accounts.map(a => [a.privateKey, a.proxy, a.username, a.password, a.status, a.points, a.message, a.websites, a.note].join('|')).join('\n');
        fetchWithAuth('/api/upload-accounts', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ accounts: accFileContent })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                fetchAccounts();
                document.getElementById('editAccountModal').classList.add('hidden');
            } else {
                alert(data.error || 'L·ªói khi c·∫≠p nh·∫≠t t√†i kho·∫£n!');
            }
        });
    };

    // Mobile menu functionality
    document.addEventListener('DOMContentLoaded', function() {
        const mobileUserToggle = document.getElementById('mobileUserToggle');
        const mobileUserDropdown = document.getElementById('mobileUserDropdown');
        const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');

        if (mobileUserToggle) {
            mobileUserToggle.addEventListener('click', function() {
                mobileUserDropdown.classList.toggle('hidden');
            });
        }

        if (mobileLogoutBtn) {
            mobileLogoutBtn.addEventListener('click', function() {
                // Clear admin session and redirect to login
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            });
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(e) {
            if (mobileUserDropdown && !mobileUserDropdown.contains(e.target) && !mobileUserToggle.contains(e.target)) {
                mobileUserDropdown.classList.add('hidden');
            }
        });
    });

    // Theme: always default to dark unless user chose light
    document.addEventListener('DOMContentLoaded', function() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            document.documentElement.classList.remove('dark');
        } else {
            document.documentElement.classList.add('dark');
        }
    });

    function maskUsername(username) {
        if (!username) return '';
        if (username.length >= 3) return username.substring(0, 3) + '*****';
        return username + '*****';
    }
    </script>
</body>
</html> 